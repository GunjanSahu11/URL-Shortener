{"version":3,"sources":["../../../src/lang/css/selector_tokenize.js"],"names":[],"mappings":"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","file":"selector_tokenize.js","sourcesContent":["import Base from '../../util/tokenize.js';\nimport TokenType from '../../util/token_type.js';\nimport {selectorBreakChar, isPseudoElement, calculateSelectorSpecificity} from './util.js';\nimport {namespaceReg} from './config.js';\n\n/**\n * css selector tokenize\n * https://www.w3.org/TR/css3-selectors/#lex\n */\nexport default class CssSelectorTokenize extends Base {\n  /**\n   * constructor\n   */\n  constructor(text, options) {\n    super(text, options);\n    this.prevToken = null;\n  }\n  /**\n   * get next token\n   * @return {Object} []\n   */\n  getNextToken() {\n    let token = super.getNextToken();\n    if (token || token === false) {\n      return token;\n    }\n    if (!this.prevToken || this.prevToken.type === TokenType.CSS_SELECTOR_COMMA) {\n      const match = this.text.match(namespaceReg);\n      if (match) {\n        this.forward(match[0].length);\n        return this.getToken(TokenType.CSS_SELECTOR_NAMESPACE, match[0]);\n      }\n    }\n    const code = this.text.charCodeAt(this.pos);\n    switch (code) {\n      case 0x2a: // *\n        return this.getToken(TokenType.CSS_SELECTOR_UNIVERSAL, this.next());\n      case 0x2c: // ,\n        return this.getToken(TokenType.CSS_SELECTOR_COMMA, this.next());\n      case 0x3e: // >\n      case 0x2b: // +\n      case 0x7e: // ~\n        return this.getToken(TokenType.CSS_SELECTOR_COMBINATOR, this.next());\n      case 0x23: // #\n        return this.getCommonToken(TokenType.CSS_SELECTOR_ID);\n      case 0x2e: // .\n        return this.getCommonToken(TokenType.CSS_SELECTOR_CLASS);\n      case 0x5b: // [\n        return this.getAttributeToken();\n      case 0x3a: // :\n        if (this.text.charCodeAt(this.pos + 1) === 0x3a) {\n          this.next();\n          token = this.getCommonToken(TokenType.CSS_SELECTOR_PSEUDO_ELEMENT);\n          token.value = ':' + token.value;\n          token.vender = token.value.charCodeAt(2) === 0x2d;\n          return token;\n        }\n        return this.getPseudoClassToken();\n      default:\n        return this.getCommonToken(TokenType.CSS_SELECTOR_TYPE);\n    }\n    // return false;\n  }\n  /**\n   * skip comment\n   * @return {void} []\n   */\n  skipComment() {\n    // start with /*\n    let comment;\n    while (this.text.charCodeAt(this.pos) === 0x2f &&\n      this.text.charCodeAt(this.pos + 1) === 0x2a) {\n      comment = this.getCommentToken(1, true);\n      this.commentBefore.push(comment);\n    }\n  }\n  /**\n   * get common token\n   * @param  {Number} type []\n   * @return {Object}      []\n   */\n  getCommonToken(type) {\n    let ret = this.next(), code;\n    while (this.pos < this.length) {\n      code = this.text.charCodeAt(this.pos);\n      if (selectorBreakChar(code) || this.isWhiteSpace(code)) {\n        break;\n      }\n      ret += this.next();\n    }\n    return this.getToken(type, ret);\n  }\n  /**\n   * get attribute token\n   * @return {Object} []\n   */\n  getAttributeToken() {\n    const ret = this.getMatchedChar(0x5b, 0x5d, {\n      quote: true\n    });\n    return this.getToken(TokenType.CSS_SELECTOR_ATTRIBUTE, ret);\n  }\n  /**\n   * get pseudo class token, support :not(xxx)\n   * @return {Object} []\n   */\n  getPseudoClassToken() {\n    let ret = this.next(), code;\n    while (this.pos < this.length) {\n      code = this.text.charCodeAt(this.pos);\n      if (code === 0x28) {\n        ret += this.getMatchedChar(0x28, 0x29, {\n          nest: true,\n          quote: true\n        });\n        continue;\n      }\n      if (selectorBreakChar(code) || this.isWhiteSpace(code)) {\n        break;\n      }\n      ret += this.next();\n    }\n    if (isPseudoElement(ret)) {\n      return this.getToken(TokenType.CSS_SELECTOR_PSEUDO_ELEMENT, ret);\n    }\n    const token = this.getToken(TokenType.CSS_SELECTOR_PSEUDO_CLASS, ret);\n    token.vender = token.value.charCodeAt(1) === 0x2d;\n    return token;\n  }\n  /**\n   * check token valid\n   * @param  {Object} token []\n   * @return {Boolean}       []\n   */\n  checkInvalid(token) {\n    switch (token.type) {\n      case TokenType.CSS_SELECTOR_CLASS:\n        if (token.value.length === 1) {\n          return true;\n        }\n        break;\n    }\n  }\n  /**\n   * run\n   * @return {Object} []\n   */\n  run() {\n    let result = [], tokens = [], token, min = -1, max = -1;\n    let specificity, invalid = false, vender = false;\n    for (; token = this.getNextToken();) {\n      this.prevToken = token;\n      if (token.type === TokenType.CSS_SELECTOR_COMMA) {\n        specificity = calculateSelectorSpecificity(tokens);\n        if (min === -1) {\n          min = max = specificity;\n        } else {\n          if (specificity < min) {\n            min = specificity;\n          }\n          if (specificity > max) {\n            max = specificity;\n          }\n        }\n        result.push({\n          tokens: tokens,\n          specificity: specificity\n        });\n        tokens = [];\n      } else {\n        if (!vender) {\n          vender = token.vender;\n        }\n        if (!invalid) {\n          invalid = this.checkInvalid(token);\n        }\n        tokens.push(token);\n      }\n    }\n    if (tokens.length) {\n      specificity = calculateSelectorSpecificity(tokens);\n      if (min === -1) {\n        min = max = specificity;\n      } else {\n        if (specificity < min) {\n          min = specificity;\n        }\n        if (specificity > max) {\n          max = specificity;\n        }\n      }\n      result.push({\n        tokens: tokens,\n        specificity: specificity\n      });\n    }\n    const data = {\n      minSpecificity: min,\n      maxSpecificity: max,\n      specificityEqual: min === max,\n      hasVender: !!vender,\n      group: result\n    };\n    if (invalid) {\n      data.invalid = true;\n    }\n    return data;\n  }\n}\n"]}